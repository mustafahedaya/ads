<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyncPlay Protection</title>
    <!-- Ad Script Start -->
    <script id="adScript" data-cfasync="false" src="//dcbbwymp1bhlf.cloudfront.net/?wbbcd=1232573"></script>
    
    <style>
        body { background: #0a0a0b; color: #fff; text-align: center; padding-top: 80px; font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; }
        .box { 
            border: 2px solid #00e676; padding: 40px; border-radius: 20px; 
            display: inline-block; max-width: 450px; width: 90%;
            background: rgba(0,230,118,0.05); transition: 0.5s; 
            backdrop-filter: blur(10px);
        }
        .error-mode { border-color: #ff5252 !important; background: rgba(255,82,82,0.05) !important; }
        
        #unlockLink { 
            display: inline-block; padding: 18px 45px; font-size: 20px; background: #00e676; 
            text-decoration: none; border-radius: 50px; font-weight: bold; color: #000; 
            transition: 0.3s; pointer-events: none; opacity: 0.1;
        }
        .active-btn { pointer-events: auto !important; opacity: 1 !important; transform: scale(1.05); box-shadow: 0 0 20px #00e676; cursor: pointer; }
        .active-btn:hover { transform: scale(1.1); box-shadow: 0 0 30px #00e676; }
        
        #msg { margin-top: 25px; font-weight: bold; line-height: 1.6; font-size: 16px; }
        .shaking { animation: shake 0.5s; }
        
        .instructions { 
            font-size: 13px; color: #ccc; margin-top: 15px; 
            padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);
            text-align: left; line-height: 1.5;
        }
        .instructions b { color: #ff5252; }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
    </style>
</head>
<body>

    <!-- Trap for AdBlockers -->
    <div class="ad-container ads-banner-top advertising_box pub_300x250" id="adTrap" 
         style="position:absolute; width:300px; height:250px; top:-1000px; left:-1000px; display:block !important; visibility:visible !important;">
        &nbsp;
    </div>

    <div class="box" id="mainBox">
        <h1 id="title" style="margin-top:0;">Security Check</h1>
        <p id="desc" style="color:#aaa;">Verifying your browser environment...</p>
        
        <div id="linkContainer">
            <!-- رابط إعلان Adsterra المباشر الخاص بك -->
            <a href="https://fibredelivery.com/aptk9jxjr?key=f4f39c9527ce233e6591af2452fadf16" 
               id="unlockLink" target="_blank" onclick="startCountdown()">UNLOCK NOW</a>
        </div>

        <div id="msg" style="color: #666;">Initializing script...</div>
        <div id="extraInstructions"></div>
    </div>

    <script>
        const unlockLink = document.getElementById('unlockLink');
        const mainBox = document.getElementById('mainBox');
        const msg = document.getElementById('msg');
        const extraInstructions = document.getElementById('extraInstructions');
        const adTrap = document.getElementById('adTrap');

        async function advancedDetection() {
            let isAdBlockActive = false;

            // الفحص الأول: فحص وجود عنصر الإعلان الوهمي
            if (window.getComputedStyle(adTrap).display === 'none' || 
                window.getComputedStyle(adTrap).visibility === 'hidden' ||
                adTrap.offsetHeight === 0) {
                isAdBlockActive = true;
            }

            // الفحص الثاني: محاولة استدعاء سكريبت إعلاني خارجي
            if (!isAdBlockActive) {
                try {
                    await fetch('https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js', {
                        method: 'HEAD', mode: 'no-cors'
                    }).catch(() => { isAdBlockActive = true; });
                } catch (e) { isAdBlockActive = true; }
            }

            if (isAdBlockActive) {
                fail();
            } else {
                success();
            }
        }

        function fail() {
            mainBox.classList.add('error-mode', 'shaking');
            msg.style.color = "#ff5252";
            msg.innerHTML = "⚠️ AdBlock or Protection Detected!";
            
            extraInstructions.innerHTML = `
                <div class="instructions">
                    If you have already disabled AdBlock and still see this:<br>
                    1. Go to browser settings and disable <b>Tracking Prevention</b>.<br>
                    2. Or add this page URL to your <b>Exceptions</b> list.
                </div>
            `;
            
            unlockLink.classList.remove('active-btn');
        }

        function success() {
            mainBox.classList.remove('error-mode');
            msg.style.color = "#00e676";
            msg.innerText = "✓ Browser Verified. You can proceed.";
            extraInstructions.innerHTML = ""; 
            unlockLink.classList.add('active-btn');
        }

        function startCountdown() {
            // منع إعادة الضغط وتغيير المظهر
            unlockLink.classList.remove('active-btn');
            unlockLink.style.opacity = "0.3";
            unlockLink.style.pointerEvents = "none";
            
            msg.innerText = "Ad opened. Verifying support... (5s)";
            
            let time = 5;
            const timer = setInterval(() => {
                time--;
                msg.innerText = "Redirecting back to SyncPlay in " + time + "s";
                
                if (time <= 0) {
                    clearInterval(timer);
                    const urlParams = new URLSearchParams(window.location.search);
                    // جلب ID الإضافة من الرابط أو استخدام الافتراضي
                    let extId = urlParams.get('extId') || "eklimlgbcncdmdgqbjljbniaeljalcoj";
                    
                    // إرسال الإشارة verified=true لتخطي عداد الإضافة
                    window.location.href = `chrome-extension://${extId}/success.html?verified=true`;
                }
            }, 1000);
        }

        // تشغيل الفحص بعد ثانية واحدة من التحميل
        window.onload = () => setTimeout(advancedDetection, 1200);
    </script>
</body>
</html>
