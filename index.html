<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyncPlay - Daily Limit</title>
    <!-- Ad Script Start -->
    <script id="adScript" data-cfasync="false" src="//dcbbwymp1bhlf.cloudfront.net/?wbbcd=1232573"></script>
    
    <style>
        body { background: #0a0a0b; color: #fff; text-align: center; padding-top: 50px; font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; }
        .box { 
            border: 2px solid #00e676; padding: 30px; border-radius: 20px; 
            display: inline-block; max-width: 500px; width: 90%;
            background: rgba(0,230,118,0.05); transition: 0.5s; 
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .error-mode { border-color: #ff5252 !important; background: rgba(255,82,82,0.05) !important; }
        
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            font-size: 14px;
            border-left: 4px solid #00e676;
        }

        #unlockLink { 
            display: inline-block; padding: 18px 45px; font-size: 18px; background: #00e676; 
            text-decoration: none; border-radius: 50px; font-weight: bold; color: #000; 
            transition: 0.3s; pointer-events: none; opacity: 0.1;
            margin-top: 10px;
        }
        .active-btn { pointer-events: auto !important; opacity: 1 !important; transform: scale(1.05); box-shadow: 0 0 20px #00e676; cursor: pointer; }
        .active-btn:hover { transform: scale(1.1); box-shadow: 0 0 30px #00e676; }
        
        #msg { margin-top: 20px; font-weight: bold; line-height: 1.6; font-size: 16px; }
        .shaking { animation: shake 0.5s; }
        
        .instructions { 
            font-size: 13px; color: #ccc; margin-top: 15px; 
            padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);
            text-align: left; line-height: 1.5;
        }
        .instructions b { color: #ff5252; }

        .limit-badge {
            background: #00e676;
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin: 0 5px;
        }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
    </style>
</head>
<body>

    <!-- Trap for AdBlockers -->
    <div class="ad-container ads-banner-top advertising_box pub_300x250" id="adTrap" 
         style="position:absolute; width:300px; height:250px; top:-1000px; left:-1000px; display:block !important; visibility:visible !important;">
        &nbsp;
    </div>

    <div class="box" id="mainBox">
        <h1 id="title" style="margin-top:0; color:#00e676;">SyncPlay Access</h1>
        
        <div class="info-card">
            <p style="margin-top:0;"><b>Why am I seeing this?</b></p>
            To keep development active and servers free, we use a daily limit system:
            <ul style="padding-left: 20px; margin-bottom: 0; margin-top: 8px;">
                <li>You have <span class="limit-badge">3</span> free rooms per day.</li>
                <li>You've reached your daily limit. Unlock more rooms by viewing an ad.</li>
                <li>After clicking the button, wait 5 seconds to be redirected.</li>
            </ul>
        </div>
        
        <p id="desc" style="color:#aaa; font-size: 14px;">Please wait while we verify your browser...</p>
        
        <div id="linkContainer">
            <a href="https://fibredelivery.com/aptk9jxjr?key=f4f39c9527ce233e6591af2452fadf16" 
               id="unlockLink" target="_blank" onclick="startCountdown()">UNLOCK ROOM NOW</a>
        </div>

        <div id="msg" style="color: #666;">Initializing verification...</div>
        <div id="extraInstructions"></div>
    </div>

    <script>
        const unlockLink = document.getElementById('unlockLink');
        const mainBox = document.getElementById('mainBox');
        const msg = document.getElementById('msg');
        const extraInstructions = document.getElementById('extraInstructions');
        const adTrap = document.getElementById('adTrap');

        async function advancedDetection() {
            let isAdBlockActive = false;

            if (window.getComputedStyle(adTrap).display === 'none' || 
                window.getComputedStyle(adTrap).visibility === 'hidden' ||
                adTrap.offsetHeight === 0) {
                isAdBlockActive = true;
            }

            if (!isAdBlockActive) {
                try {
                    await fetch('https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js', {
                        method: 'HEAD', mode: 'no-cors'
                    }).catch(() => { isAdBlockActive = true; });
                } catch (e) { isAdBlockActive = true; }
            }

            if (isAdBlockActive) {
                fail();
            } else {
                success();
            }
        }

        function fail() {
            mainBox.classList.add('error-mode', 'shaking');
            msg.style.color = "#ff5252";
            msg.innerHTML = "⚠️ AdBlock Detected!";
            document.getElementById('desc').innerText = "Please disable AdBlock to continue.";
            
            extraInstructions.innerHTML = `
                <div class="instructions">
                    If you already disabled AdBlock and still see this:<br>
                    1. Disable <b>Tracking Prevention</b> in browser settings.<br>
                    2. Or add this URL to your <b>Safe List/Exceptions</b>.
                </div>
            `;
            
            unlockLink.classList.remove('active-btn');
        }

        function success() {
            mainBox.classList.remove('error-mode');
            msg.style.color = "#00e676";
            msg.innerText = "✓ Browser Verified. Click to proceed.";
            document.getElementById('desc').innerText = "Security check passed.";
            extraInstructions.innerHTML = ""; 
            unlockLink.classList.add('active-btn');
        }

        function startCountdown() {
            unlockLink.classList.remove('active-btn');
            unlockLink.style.opacity = "0.3";
            unlockLink.style.pointerEvents = "none";
            
            msg.innerText = "Ad opened. Verifying support... (5s)";
            
            let time = 5;
            const timer = setInterval(() => {
                time--;
                msg.innerText = "Redirecting back to SyncPlay in " + time + "s";
                
                if (time <= 0) {
                    clearInterval(timer);
                    const urlParams = new URLSearchParams(window.location.search);
                    let extId = urlParams.get('extId') || "eklimlgbcncdmdgqbjljbniaeljalcoj";
                    
                    window.location.href = `chrome-extension://${extId}/success.html?verified=true`;
                }
            }, 1000);
        }

        window.onload = () => setTimeout(advancedDetection, 1200);
    </script>
</body>
</html>
